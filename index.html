<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>CoastFIRE by Age and Spend</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Source+Sans+3:wght@400;600&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="page">
      <header class="hero">
        <div>
          <p class="eyebrow">CoastFIRE calculator</p>
          <h1>CoastFIRE by Age and Spend</h1>
          <p class="subhead">
            This recreates the spreadsheet math. Each input updates the required assets for every retirement age and
            spending level. The chart shows the selected spending level, while the table shows the full grid.
          </p>
        </div>
        <div class="hero-card">
          <div class="stat">
            <span class="stat-label">Current assets</span>
            <span id="statAssets" class="stat-value">$0</span>
          </div>
          <div class="stat">
            <span class="stat-label">Selected spending</span>
            <span id="statSpend" class="stat-value">$0</span>
          </div>
          <div class="stat">
            <span class="stat-label">Coast age (selected spend)</span>
            <span id="statCoast" class="stat-value">-</span>
          </div>
        </div>
      </header>

      <section class="panel">
        <div class="inputs">
          <h2>Inputs</h2>
          <p class="section-note">
            These inputs mirror the spreadsheet. All rates are decimals (0.04 = 4%).
          </p>
          <div class="input-grid">
            <label class="field">
              <span>Current Assets Invested</span>
              <input id="currentAssets" type="number" min="0" step="1000" />
              <small>How much you have invested today.</small>
            </label>
            <label class="field">
              <span>Current Age</span>
              <input id="currentAge" type="number" min="0" step="1" />
              <small>Starting age for the retirement-age rows.</small>
            </label>
            <label class="field">
              <span>Safe Withdrawal Rate</span>
              <input id="swr" type="number" min="0" step="0.001" />
              <small>Enter as a decimal (e.g., 0.04 = 4%).</small>
            </label>
            <label class="field">
              <span>Investment Return Rate</span>
              <input id="returnRate" type="number" step="0.001" />
              <small>Expected annual return (e.g., 0.10 = 10%).</small>
            </label>
            <label class="field">
              <span>Inflation</span>
              <input id="inflation" type="number" step="0.001" />
              <small>Expected annual inflation (e.g., 0.04 = 4%).</small>
            </label>
          </div>
        </div>

        <div class="spend">
          <h2>Annual Spending in Retirement</h2>
          <p class="section-note">
            Pick a spending level to update the chart and highlight the Coast age in the stats.
          </p>
          <div class="spend-controls">
            <input id="spendRange" type="range" min="50000" max="300000" step="1000" />
            <div class="spend-readout">
              <input id="spendInput" type="number" min="50000" max="300000" step="1000" />
              <span class="hint">$50k to $300k, step $1k</span>
            </div>
          </div>
          <div class="warnings" id="warnings"></div>
        </div>
      </section>

      <section class="panel chart-panel">
        <div class="chart-header">
          <div>
            <h2>Required Assets Today vs. Retirement Age</h2>
            <p class="section-note">
              Each point is the assets required today to fund the selected spending at that retirement age.
            </p>
            <p class="formula">
              Formula: (spending / SWR) / (1 + return - inflation)^(retirement age - current age)
            </p>
          </div>
          <div class="legend">
            <span class="dot dot-primary"></span>
            <span>Required assets today (selected spending)</span>
            <span class="dot dot-secondary"></span>
            <span>Your current assets (flat line)</span>
          </div>
        </div>
        <canvas id="coastChart" height="320"></canvas>
        <p class="section-note">
          If the orange line is below the teal line at an age, you are CoastFIRE at that age for the selected spending.
        </p>
      </section>

      <section class="panel chart-panel">
        <div class="chart-header">
          <div>
            <h2>Asset Growth While Coasting</h2>
            <p class="section-note">
              This shows how your current assets grow if you stop contributing and let them compound at the real return
              (return minus inflation). The required line is the target nest egg for the selected spending.
            </p>
          </div>
          <div class="legend">
            <span class="dot dot-primary"></span>
            <span>Coasting assets over time</span>
            <span class="dot dot-secondary"></span>
            <span>Required nest egg at retirement (spending / SWR)</span>
          </div>
        </div>
        <canvas id="coastGrowthChart" height="320"></canvas>
      </section>

      <section class="panel table-panel">
        <div class="table-header">
          <div>
            <h2>Full Grid (Retirement Age x Spending)</h2>
            <p class="section-note">
              Each cell is the required assets today for that retirement age (row) and spending level (column).
            </p>
          </div>
          <div class="table-actions">
            <button id="downloadCsv" type="button">Download CSV</button>
            <button id="scrollTop" type="button">Scroll to Top</button>
          </div>
        </div>
        <div class="table-wrap" id="tableWrap">
          <table id="gridTable"></table>
        </div>
      </section>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="app.js"></script>
  </body>
</html>
